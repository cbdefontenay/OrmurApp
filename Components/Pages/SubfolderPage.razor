@page "/subfolder/{SubfolderId:int}"
@inject SqliteConnector Db
@using Ormur.Components.Shared
@layout GoBackLayout

<div class="subfolder-page">
    <div class="header">
        <h1>@_subfolder?.Name</h1>
        <p class="subtitle">Erstellt am: @_subfolder?.DateCreated.ToString("f")</p>
    </div>

    <div class="choice-container">
        <h3 class="choice-title">Wie möchtest du dein Text schreiben?</h3>
        <div class="choice-actions">
            <button class="m3-button m3-filled-button" @onclick="OnMarkdownChoice">
                <span class="m3-button-label">Markdown</span>
            </button>
        </div>
    </div>

    @if (ShowMarkdownEditor)
    {
        <div class="subfolder-container elevation-1">
            <MarkdownEditorComponent SubfolderId="SubfolderId"/>
        </div>
    }
    else
    {
        <div class="empty-state elevation-0">
            <span class="material-symbols-outlined">edit_note</span>
            <h2>Kein Editor gewählt</h2>
        </div>
    }
</div>

@code {
    [Parameter] public int SubfolderId { get; set; }
    private bool ShowMarkdownEditor { get; set; } = false;
    private SubfolderModel? _subfolder;

    protected override async Task OnParametersSetAsync()
    {
        await LoadSubfolderAsync();
    }

    private async Task LoadSubfolderAsync()
    {
        try
        {
            _subfolder = await Db.GetSubfolderAsync(SubfolderId);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading subfolder: {ex.Message}");
        }
    }
    
    private void OnMarkdownChoice()
    {
        ShowMarkdownEditor = true;
    }
}