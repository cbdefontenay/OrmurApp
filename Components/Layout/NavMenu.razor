@inherits LayoutComponentBase
@inject NavigationManager NavigationManager

@switch (IsAndroidPlatform)
{
    case true:
        <div class="android-layout">
            <nav class="navbar-android-container">
                <div class="hamburger-menu-wrapper" @onclick="ToggleMenu">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 18L20 18" stroke="#000000" stroke-width="2" stroke-linecap="round"/>
                        <path d="M4 12L20 12" stroke="#000000" stroke-width="2" stroke-linecap="round"/>
                        <path d="M4 6L20 6" stroke="#000000" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </div>

                @if (IsMenuOpen || IsAnimatingOut)
                {
                    <div class="menu-drawer-overlay @(IsAnimatingOut ? "hide" : "show")" @onclick="CloseMenu">
                        <div class="menu-drawer @(IsAnimatingOut ? "slide-out" : "slide-in")" @onclick:stopPropagation>
                            <div class="logo-wrapper">
                                <img src="Images/logo.svg" alt="Ormur Logo" class="navbar-logo"/>
                                <h2 class="desktop-menu-header">
                                    Ormur
                                </h2>
                            </div>
                            <ul class="menu-items">
                                @foreach (var item in _navItems)
                                {
                                    <li class="menu-item" @onclick="@(() => Navigate(item.Value))">
                                        @item.Key
                                    </li>
                                }
                            </ul>

                            <div class="menu-help-icon" @onclick="OnHelpClicked">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="28" height="28">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10
                 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm1.07-7.75
                 -.9.92C12.45 12.9 12 13.5 12 15h-2v-.5c0-1
                 .45-1.99 1.17-2.7l1.24-1.26c.37-.36.59-.86.59-1.41
                 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4
                 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
                                </svg>
                            </div>

                        </div>
                    </div>
                }
           </nav>

            <div class="android-page-content">
                @ChildContent
            </div>
        </div>
        break;

    default:
        <div class="layout-container">
            <nav class="navbar-desktop-container">
                <div class="logo-wrapper">
                    <img src="Images/logo.svg" alt="Ormur Logo" class="navbar-logo"/>
                    <h2 class="desktop-menu-header">
                        Ormur
                    </h2>
                </div>
                <ul class="desktop-menu-items">
                    @foreach (var item in _navItems)
                    {
                        <li class="desktop-menu-item" @onclick="@(() => Navigate(item.Value))">
                            @item.Key
                        </li>
                    }
                </ul>

                <div class="desktop-menu-help-container">
                    <div class="desktop-menu-help-icon" @onclick="OnHelpClicked">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="28" height="28">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10
                 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm1.07-7.75
                 -.9.92C12.45 12.9 12 13.5 12 15h-2v-.5c0-1
                 .45-1.99 1.17-2.7l1.24-1.26c.37-.36.59-.86.59-1.41
                 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4
                 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
                        </svg>
                    </div>
                </div>
            </nav>
            <div class="desktop-page-content">
                @ChildContent
            </div>
        </div>
        break;
}

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }

    private bool IsAndroidPlatform { get; set; }
    private bool IsMenuOpen { get; set; } = false;
    private bool IsAnimatingOut { get; set; } = false;

    private void ToggleMenu()
    {
        if (!IsMenuOpen)
        {
            IsMenuOpen = true;
            IsAnimatingOut = false;
        }
    }

    private async Task CloseMenu()
    {
        IsAnimatingOut = true;
        StateHasChanged();
        await Task.Delay(300); // match the CSS transition time
        IsMenuOpen = false;
        IsAnimatingOut = false;
        StateHasChanged();
    }

    private async Task Navigate(string url)
    {
        await CloseMenu(); // trigger close animation
        NavigationManager.NavigateTo(url);
    }

    private readonly Dictionary<string, string> _navItems = new()
    {
        { "Home", "/" },
        { "Editor", "/counter" },
        { "Settings", "/weather" },
        { "Sync", "/sync" },
    };

    protected override void OnInitialized()
    {
#if ANDROID
        IsAndroidPlatform = true;
#else
        IsAndroidPlatform = false;
#endif
    }
    
    private static void OnHelpClicked()
    {
        App.Current.MainPage.Navigation.PushAsync(new AboutOrmurView());
    }


}